(()=>{"use strict";var t={533:(t,e,s)=>{const i=s(338),r=s(494),h=s(997),n=s(158);t.exports=class{constructor(t,e,s,n,o,a=3){this.x=t,this.y=e,this.width=s,this.height=n,this.speed=0,this.acceleration=.2,this.maxSpeed=a,this.friction=.05,this.angle=0,this.damaged=!1,this.useBrain="AI"==o,"DUMMY"!==o&&(this.sensor=new h(this),this.brain=new i([this.sensor.rayCount,6,4])),this.controls=new r(o)}update(t,e){if(this.damaged||(this.move(),this.polygon=this.createPolygon(),this.damaged=this.assessDamage(t,e)),this.sensor){this.sensor.update(t,e);const s=this.sensor.readings.map((t=>null==t?0:1-t.offset)),i=n.networkFeedForward(s,this.brain);this.useBrain&&(this.controls.forward=i[0],this.controls.left=i[1],this.controls.right=i[2],this.controls.reverse=i[3])}}move(){if(this.controls.forward&&(this.speed+=this.acceleration),this.controls.reverse&&(this.speed-=this.acceleration),this.speed>this.maxSpeed&&(this.speed=this.maxSpeed),this.speed<-this.maxSpeed/2&&(this.speed=-this.maxSpeed/2),this.speed>0&&(this.speed-=this.friction),this.speed<0&&(this.speed+=this.friction),Math.abs(this.speed)<this.friction&&(this.speed=0),0!=this.speed){const t=this.speed>0?1:-1;this.controls.left&&(this.angle+=.03*t),this.controls.right&&(this.angle-=.03*t)}this.x-=Math.sin(this.angle)*this.speed,this.y-=Math.cos(this.angle)*this.speed}assessDamage(t,e){for(let e=0;e<t.length;e++)if(n.polysIntersect(this.polygon,t[e]))return!0;for(let t=0;t<e.length;t++)if(n.polysIntersect(this.polygon,e[t].polygon))return!0;return!1}createPolygon(){const t=[],e=Math.hypot(this.width,this.height)/2,s=Math.atan2(this.width,this.height);return t.push({x:this.x-Math.sin(this.angle-s)*e,y:this.y-Math.cos(this.angle-s)*e}),t.push({x:this.x-Math.sin(this.angle+s)*e,y:this.y-Math.cos(this.angle+s)*e}),t.push({x:this.x-Math.sin(Math.PI+this.angle-s)*e,y:this.y-Math.cos(Math.PI+this.angle-s)*e}),t.push({x:this.x-Math.sin(Math.PI+this.angle+s)*e,y:this.y-Math.cos(Math.PI+this.angle+s)*e}),t}draw(t,e){this.damaged?t.fillStyle="gray":t.fillStyle=e,t.beginPath(),t.moveTo(this.polygon[0].x,this.polygon[0].y);for(let e=1;e<this.polygon.length;e++)t.lineTo(this.polygon[e].x,this.polygon[e].y);t.fill(),this.sensor&&this.sensor.draw(t)}}},494:t=>{t.exports=class{constructor(t){this.forward=!1,this.left=!1,this.right=!1,this.reverse=!1,"KEYS"===t?this.addKeyboardListeners():"DUMMY"===t&&(this.forward=!0)}addKeyboardListeners(){document.onkeydown=t=>{switch(t.key){case"ArrowLeft":this.left=!0;break;case"ArrowRight":this.right=!0;break;case"ArrowUp":this.forward=!0;break;case"ArrowDown":this.reverse=!0}},document.onkeyup=t=>{switch(t.key){case"ArrowLeft":this.left=!1;break;case"ArrowRight":this.right=!1;break;case"ArrowUp":this.forward=!1;break;case"ArrowDown":this.reverse=!1}}}}},338:(t,e,s)=>{const i=s(158);class r{constructor(t,e){this.inputs=new Array(t),this.outputs=new Array(e),this.biases=new Array(e),this.weights=[];for(let s=0;s<t;s++)this.weights[s]=new Array(e);i.randomize(this)}randomize(t){i.randomize(t)}feedForward(t,e){return i.feedForward(t,e)}}t.exports=class{constructor(t){this.levels=[];for(let e=0;e<t.length-1;e++)this.levels.push(new r(t[e],t[e+1]))}feedForward(t,e){return i.networkFeedForward(t,e)}}},621:(t,e,s)=>{const i=s(158);t.exports=class{constructor(t,e,s=3){this.x=t,this.width=e,this.laneCount=s,this.left=t-e/2,this.right=t+e/2;this.top=-1e6,this.bottom=1e6;const i={x:this.left,y:this.top},r={x:this.right,y:this.top},h={x:this.left,y:this.bottom},n={x:this.right,y:this.bottom};this.borders=[[i,h],[r,n]]}getLaneCenter(t){const e=this.width/this.laneCount;return this.left+e/2+Math.min(t,this.laneCount-1)*e}draw(t){t.lineWidth=5,t.strokeStyle="white";for(let e=1;e<=this.laneCount-1;e++){const s=i.lerp(this.left,this.right,e/this.laneCount);t.setLineDash([20,20]),t.beginPath(),t.moveTo(s,this.top),t.lineTo(s,this.bottom),t.stroke()}t.setLineDash([]),this.borders.forEach((e=>{t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke()}))}}},997:(t,e,s)=>{const i=s(158);t.exports=class{constructor(t){this.car=t,this.rayCount=5,this.rayLength=150,this.raySpread=Math.PI/2,this.rays=[],this.readings=[]}update(t,e){this.castRays(),this.readings=[];for(let s=0;s<this.rays.length;s++)this.readings.push(this.getReading(this.rays[s],t,e))}getReading(t,e,s){let r=[];for(let s=0;s<e.length;s++){const h=i.getIntersection(t[0],t[1],e[s][0],e[s][1]);h&&r.push(h)}for(let e=0;e<s.length;e++){const h=s[e].polygon;for(let e=0;e<h.length;e++){const s=i.getIntersection(t[0],t[1],h[e],h[(e+1)%h.length]);s&&r.push(s)}}if(0==r.length)return null;{const t=r.map((t=>t.offset)),e=Math.min(...t);return r.find((t=>t.offset==e))}}castRays(){this.rays=[];for(let t=0;t<this.rayCount;t++){const e=i.lerp(this.raySpread/2,-this.raySpread/2,1==this.rayCount?.5:t/(this.rayCount-1))+this.car.angle,s={x:this.car.x,y:this.car.y},r={x:this.car.x-Math.sin(e)*this.rayLength,y:this.car.y-Math.cos(e)*this.rayLength};this.rays.push([s,r])}}draw(t){for(let e=0;e<this.rayCount;e++){let s=this.rays[e][1];this.readings[e]&&(s=this.readings[e]),t.beginPath(),t.lineWidth=2,t.strokeStyle="yellow",t.moveTo(this.rays[e][0].x,this.rays[e][0].y),t.lineTo(s.x,s.y),t.stroke(),t.beginPath(),t.lineWidth=2,t.strokeStyle="black",t.moveTo(this.rays[e][1].x,this.rays[e][1].y),t.lineTo(s.x,s.y),t.stroke()}}}},158:t=>{const e={lerp:function(t,e,s){return t+(e-t)*s},getIntersection:function(t,s,i,r){const h=(r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x),n=(i.y-t.y)*(t.x-s.x)-(i.x-t.x)*(t.y-s.y),o=(r.y-i.y)*(s.x-t.x)-(r.x-i.x)*(s.y-t.y);if(0!=o){const i=h/o,r=n/o;if(i>=0&&i<=1&&r>=0&&r<=1)return{x:e.lerp(t.x,s.x,i),y:e.lerp(t.y,s.y,i),offset:i}}return null},polysIntersect:function(t,s){for(let i=0;i<t.length;i++)for(let r=0;r<s.length;r++)if(e.getIntersection(t[i],t[(i+1)%t.length],s[r],s[(r+1)%s.length]))return!0;return!1},feedForward:function(t,e){for(let s=0;s<e.inputs.length;s++)e.inputs[s]=t[s];for(let t=0;t<e.outputs.length;t++){let s=0;for(let i=0;i<e.inputs.length;i++)s+=e.inputs[i]*e.weights[i][t];s>e.biases[t]?e.outputs[t]=1:e.outputs[t]=0}return e.outputs},networkFeedForward:function(t,s){let i=e.feedForward(t,s.levels[0]);for(let t=1;t<s.levels.length;t++)i=e.feedForward(i,s.levels[t]);return i},randomize:function(t){for(let e=0;e<t.inputs.length;e++)for(let s=0;s<t.outputs.length;s++)t.weights[e][s]=2*Math.random()-1;for(let e=0;e<t.biases.length;e++)t.biases[e]=2*Math.random()-1}};t.exports=e}},e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={exports:{}};return t[i](r,r.exports,s),r.exports}(()=>{const t=s(533),e=s(621);document.addEventListener("DOMContentLoaded",(function(){const s=document.querySelector("canvas"),i=s.getContext("2d"),r=new e(s.width/2,.9*s.width),h=new t(r.getLaneCenter(1),100,30,50,"AI"),n=[new t(r.getLaneCenter(1),-100,30,50,"DUMMY",2)];!function t(){for(let t=0;t<n.length;t++)n[t].update(r.borders,[]);h.update(r.borders,n),s.height=window.innerHeight,i.save(),i.translate(0,-h.y+.75*s.height),r.draw(i);for(let t=0;t<n.length;t++)n[t].draw(i,"#7bb24d");h.draw(i,"#de6717"),i.restore(),requestAnimationFrame(t)}()}))})()})();
//# sourceMappingURL=car_895097ed0ef2a7fc0a54.js.map